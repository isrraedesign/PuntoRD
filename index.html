<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mapa Puerto Plata - C贸mo llegar en tiempo real</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css"/>
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css"/>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>

<style>
html, body { height:100%; margin:0; padding:0; font-family:Arial; }
#map { height:100%; width:100%; }
.panel { position:absolute; top:10px; left:10px; width:350px; max-height:90%; overflow:auto; background:white; padding:12px; border-radius:12px; box-shadow:0 6px 20px rgba(0,0,0,0.15); z-index:1000;}
.panel h3 { margin-top:0; }
.search { width:95%; padding:6px; margin-bottom:8px; border-radius:6px; border:1px solid #ccc; }
.place { padding:6px; border-bottom:1px solid #eee; }
button { padding:5px 8px; border-radius:6px; border:none; cursor:pointer; margin-top:4px; background:#0284c7; color:white; }
button:hover { background:#0369a1; }
.langbox { position:absolute; top:10px; right:10px; background:white; padding:8px; border-radius:10px; box-shadow:0 4px 12px rgba(0,0,0,0.15); z-index:1000;}
.chip { display:inline-block; padding:5px 10px; border-radius:20px; background:#e2e8f0; color:#1e293b; margin:4px; cursor:pointer; }
.chip.active { background:#0284c7; color:white; }
</style>
</head>
<body>

<div id="map"></div>

<div class="panel">
<h3>Puerto Plata</h3>
<input class="search" id="searchBox" placeholder="Buscar lugar...">
<div id="filters">
  <span class="chip active" data-cat="all">Todos</span>
  <span class="chip" data-cat="street">Calles</span>
  <span class="chip" data-cat="restaurant">Restaurantes</span>
  <span class="chip" data-cat="hotel">Hoteles / Villas</span>
  <span class="chip" data-cat="beach">Playas</span>
  <span class="chip" data-cat="port">Puertos</span>
  <span class="chip" data-cat="danger">Precauci贸n</span>
</div>
<div id="placesList"></div>
</div>

<div class="langbox">
<button onclick="setLang('es')"></button>
<button onclick="setLang('en')"></button>
<button onclick="setLang('fr')"></button>
</div>

<script>
document.addEventListener('DOMContentLoaded', ()=>{

let LANG='es';
const map = L.map('map').setView([19.7934,-70.6884],13);
L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19, attribution:'漏 OpenStreetMap'}).addTo(map);

const ICONS = {street:'#64748b', restaurant:'#ef4444', hotel:'#06b6d4', beach:'#0284c7', port:'#f97316', danger:'#ef4444', default:'#64748b'};

let userMarker=null, userLoc=null, routeLine=null;

const places=[
{name:'Calle Duarte',lat:19.8020,lon:-70.6880,category:'street',desc:{es:'Calle principal',en:'Main street',fr:'Rue principale'}},
{name:'Calle Beller',lat:19.8000,lon:-70.6890,category:'street',desc:{es:'Calle c茅ntrica',en:'Central street',fr:'Rue centrale'}},
{name:'Calle Las Sombrillas',lat:19.8030,lon:-70.6900,category:'street',desc:{es:'Zona tur铆stica',en:'Tourist area',fr:'Zone touristique'}},
{name:'Av. Gregorio Luper贸n',lat:19.8050,lon:-70.6920,category:'street',desc:{es:'Avenida principal',en:'Main avenue',fr:'Avenue principale'}},
{name:'La Casita Azul',lat:19.7760,lon:-70.6420,category:'restaurant',desc:{es:'Restaurante t铆pico',en:'Typical restaurant',fr:'Restaurant typique'}},
{name:'Sambal煤',lat:19.7770,lon:-70.6430,category:'restaurant',desc:{es:'Comida internacional',en:'International food',fr:'Cuisine internationale'}},
{name:'Iberostar Waves Costa Dorada',lat:19.7740,lon:-70.6421,category:'hotel',desc:{es:'Hotel all inclusive',en:'All-inclusive hotel',fr:'H么tel tout compris'}},
{name:'BlueBay Villas Doradas',lat:19.7750,lon:-70.6430,category:'hotel',desc:{es:'Adults only resort',en:'Adults only resort',fr:'Resort pour adultes'}},
{name:'Playa Dorada',lat:19.7740,lon:-70.6421,category:'beach',desc:{es:'Playa de arena dorada',en:'Golden sand beach',fr:'Plage de sable dor茅'}},
{name:'Playa Sos煤a',lat:19.7240,lon:-70.5080,category:'beach',desc:{es:'Playa tur铆stica',en:'Tourist beach',fr:'Plage touristique'}},
{name:'Puerto de Amber Cove',lat:19.8050,lon:-70.7440,category:'port',desc:{es:'Puerto de cruceros',en:'Cruise port',fr:'Port de croisi猫re'}},
{name:'Calle Isabel de Torres',lat:19.7830,lon:-70.7040,category:'street',desc:{es:'Calle tur铆stica',en:'Tourist street',fr:'Rue touristique'}},
// Agrega el resto de tus lugares aqu铆
];

const markers = L.markerClusterGroup();

// Funci贸n de ruta
async function showRoute(lat, lon, name){
  if(!userLoc){ alert(LANG==='es'?'No se detecta ubicaci贸n':'No location detected'); return; }
  const url = `https://router.project-osrm.org/route/v1/driving/${userLoc[1]},${userLoc[0]};${lon},${lat}?overview=full&geometries=geojson`;
  const res = await fetch(url); const data = await res.json();
  if(routeLine) map.removeLayer(routeLine);
  const coords = data.routes[0].geometry.coordinates.map(c=>[c[1],c[0]]);
  routeLine = L.polyline(coords,{color:'#2563eb',weight:5}).addTo(map);
  map.fitBounds(routeLine.getBounds());
  const mins = Math.round(data.routes[0].duration/60);
  const km = (data.routes[0].distance/1000).toFixed(1);
  alert(`${LANG==='es'? 'Destino':'Destination'}: ${name}\n${LANG==='es'? 'Distancia':'Distance'}: ${km} km\n${LANG==='es'? 'Tiempo estimado':'Estimated time'}: ${mins} min`);
}

// Crear marcadores
places.forEach(p=>{
  const color = ICONS[p.category]||ICONS.default;
  const marker = L.marker([p.lat,p.lon],{
    icon:L.divIcon({
      html:`<div style="width:16px;height:16px;background:${color};border-radius:50%;border:2px solid white;"></div>`,
      className:'', iconSize:[16,16]
    })
  });

  marker.bindPopup(`<b>${p.name}</b><br>${p.desc[LANG]}<br><button class="routeBtn">${LANG==='es'?'C贸mo llegar':LANG==='en'?'Directions':'Itin茅raire'}</button>`);

  marker.on('popupopen', function(){
    const btn = document.querySelector('.leaflet-popup-content button.routeBtn');
    if(btn) btn.onclick = ()=>showRoute(p.lat,p.lon,p.name);
  });

  markers.addLayer(marker);
  p.marker = marker;
});

map.addLayer(markers);

// Lista lateral
const list = document.getElementById('placesList');
function renderList(){
  list.innerHTML='';
  const query = document.getElementById('searchBox').value.toLowerCase();
  const filter = document.querySelector('#filters .active')?.dataset.cat || 'all';
  places.filter(p=>{
    if(filter!=='all' && p.category!==filter) return false;
    if(query && !p.name.toLowerCase().includes(query) && !p.desc[LANG].toLowerCase().includes(query)) return false;
    return true;
  }).forEach(p=>{
    const div = document.createElement('div');
    div.className='place';
    div.innerHTML = `<b>${p.name}</b><br>${p.desc[LANG]}<br>
      <button onclick="map.flyTo([${p.lat},${p.lon}],16)">${LANG==='es'?'Ver':LANG==='en'?'View':'Voir'}</button>
      <button onclick="showRoute(${p.lat},${p.lon},'${p.name}')">${LANG==='es'?'C贸mo llegar':LANG==='en'?'Directions':'Itin茅raire'}</button>`;
    list.appendChild(div);
  });
}
renderList();
document.getElementById('searchBox').addEventListener('input',renderList);

// Filtros
document.querySelectorAll('#filters .chip').forEach(c=>{
  c.addEventListener('click',()=>{
    document.querySelectorAll('#filters .chip').forEach(x=>x.classList.remove('active'));
    c.classList.add('active');
    renderList();
  });
});

// Cambiar idioma
function setLang(l){
  LANG=l;
  markers.eachLayer(m=>{
    const p = places.find(x=>x.marker===m);
    if(p) m.bindPopup(`<b>${p.name}</b><br>${p.desc[LANG]}<br><button class="routeBtn">${LANG==='es'?'C贸mo llegar':LANG==='en'?'Directions':'Itin茅raire'}</button>`);
  });
  renderList();
}

// GPS
if(navigator.geolocation){
  navigator.geolocation.watchPosition(pos=>{
    userLoc=[pos.coords.latitude,pos.coords.longitude];
    if(!userMarker){
      userMarker=L.marker(userLoc,{icon:L.divIcon({html:`<div style="width:12px;height:12px;background:green;border-radius:50%"></div>`})}).addTo(map);
      map.setView(userLoc,13);
    } else userMarker.setLatLng(userLoc);
  });
}

});
</script>
</body>
</html>
