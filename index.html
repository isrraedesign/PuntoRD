<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mapa TurÃ­stico de Puerto Plata</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.css">
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.Default.css">
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body,html {margin:0;padding:0;height:100%;}
  #map {height:100vh;width:100%;}
  .leaflet-popup-content {font-size:0.9rem;}
  .cat-badge{display:inline-block;padding:2px 6px;border-radius:6px;font-size:0.7rem;color:#fff}
  .cat-beach{background:#1E90FF}.cat-hotel{background:#00B894}.cat-restaurant{background:#FF7675}
  .cat-park{background:#27AE60}.cat-attraction{background:#FDCB6E}.cat-danger{background:#E74C3C}
</style>
</head>
<body class="bg-blue-50">
<div class="flex flex-col md:flex-row h-screen">
  <div class="w-full md:w-1/4 bg-white p-4 overflow-y-auto shadow-lg z-10">
    <h1 class="text-2xl font-bold mb-2 text-blue-700">Mapa TurÃ­stico de Puerto Plata</h1>
    <p class="text-sm mb-2 text-gray-600">
      ğŸ‡ªğŸ‡¸ Explora lugares, playas, hoteles y rutas<br>
      ğŸ‡¬ğŸ‡§ Explore places, beaches, hotels and routes<br>
      ğŸ‡«ğŸ‡· DÃ©couvrez les lieux, plages, hÃ´tels et itinÃ©raires
    </p>
    <input id="search" type="text" placeholder="Buscar / Search / Rechercher..." 
           class="w-full border rounded-lg p-2 mb-4">
    <div id="placesList" class="space-y-2"></div>
  </div>
  <div id="map" class="flex-1"></div>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.markercluster/dist/leaflet.markercluster.js"></script>
<script>
const map=L.map('map').setView([19.7934,-70.6884],13);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
  maxZoom:19,
  attribution:'&copy; OpenStreetMap'
}).addTo(map);

// --- AquÃ­ estÃ¡ la lista de lugares (truncada, en la versiÃ³n final irÃ¡n los 300) ---
const places=[
  {name:"TelefÃ©rico Isabel de Torres",coords:[19.7829,-70.7038],cat:"attraction",
   desc:{es:"TelefÃ©rico al monte Isabel de Torres",en:"Cable car to Mount Isabel de Torres",fr:"TÃ©lÃ©phÃ©rique vers le mont Isabel de Torres"}},
  {name:"Fortaleza San Felipe",coords:[19.801283,-70.690886],cat:"attraction",
   desc:{es:"Fuerte histÃ³rico del siglo XVI",en:"16th century fortress",fr:"Forteresse du XVIáµ‰ siÃ¨cle"}},
  {name:"Playa Dorada",coords:[19.7753,-70.6424],cat:"beach",
   desc:{es:"Playa popular con hoteles",en:"Popular beach with hotels",fr:"Plage populaire avec hÃ´tels"}},
  {name:"Museo del Ãmbar",coords:[19.7964,-70.6922],cat:"attraction",
   desc:{es:"Museo dedicado al Ã¡mbar dominicano",en:"Museum of Dominican amber",fr:"MusÃ©e de lâ€™ambre dominicain"}},
  {name:"Parque Central",coords:[19.795,-70.6939],cat:"park",
   desc:{es:"Plaza principal de la ciudad",en:"Main city square",fr:"Place principale de la ville"}},
  {name:"Zona de precauciÃ³n (barrio bajo)",coords:[19.7950,-70.6990],cat:"danger",
   desc:{es:"Evite caminar solo tarde",en:"Avoid walking alone late",fr:"Ã‰vitez de marcher seul tard"}}
];

// --- Iconos bÃ¡sicos ---
const icons={
  beach:"ğŸ–ï¸",hotel:"ğŸ¨",restaurant:"ğŸ½ï¸",park:"ğŸŒ³",attraction:"ğŸ¡",danger:"âš ï¸"
};

// --- Mostrar marcadores ---
const cluster=L.markerClusterGroup();
places.forEach(p=>{
  const marker=L.marker(p.coords).bindPopup(`
    <b>${p.name}</b><br>
    <span class="cat-badge cat-${p.cat}">${p.cat}</span><br><br>
    ğŸ‡ªğŸ‡¸ ${p.desc.es}<br>ğŸ‡¬ğŸ‡§ ${p.desc.en}<br>ğŸ‡«ğŸ‡· ${p.desc.fr}<br>
    <button onclick="routeTo(${p.coords[0]},${p.coords[1]})"
      class='mt-2 px-2 py-1 bg-blue-600 text-white rounded text-xs'>CÃ³mo llegar / Get there / ItinÃ©raire</button>
  `);
  cluster.addLayer(marker);
});
map.addLayer(cluster);

// --- Lista lateral ---
const list=document.getElementById('placesList');
function renderList(f=""){
  list.innerHTML="";
  places.filter(p=>p.name.toLowerCase().includes(f.toLowerCase())).forEach(p=>{
    const div=document.createElement('div');
    div.className="p-2 border rounded hover:bg-blue-50 cursor-pointer";
    div.innerHTML=`${icons[p.cat]||"ğŸ“"} <b>${p.name}</b>`;
    div.onclick=()=>map.setView(p.coords,16);
    list.appendChild(div);
  });
}
renderList();
document.getElementById('search').addEventListener('input',e=>renderList(e.target.value));

// --- Rutas con OSRM ---
let routeLayer;
function routeTo(lat,lon){
  if(routeLayer)map.removeLayer(routeLayer);
  if(navigator.geolocation){
    navigator.geolocation.getCurrentPosition(pos=>{
      const {latitude,longitude}=pos.coords;
      fetch(`https://router.project-osrm.org/route/v1/driving/${longitude},${latitude};${lon},${lat}?overview=full&geometries=geojson`)
        .then(r=>r.json()).then(data=>{
          const coords=data.routes[0].geometry.coordinates.map(c=>[c[1],c[0]]);
          routeLayer=L.polyline(coords,{color:'blue',weight:4}).addTo(map);
          map.fitBounds(routeLayer.getBounds());
          alert("â± DuraciÃ³n estimada â‰ˆ "+(data.routes[0].duration/60).toFixed(1)+" min");
        });
    });
  }else alert("No se pudo obtener ubicaciÃ³n actual.");
}

// --- Marcador en tiempo real ---
let userMarker;
if(navigator.geolocation){
  navigator.geolocation.watchPosition(pos=>{
    const {latitude,longitude}=pos.coords;
    if(!userMarker){
      userMarker=L.marker([latitude,longitude],{title:"Tu ubicaciÃ³n / Your location / Votre position"}).addTo(map);
    }else userMarker.setLatLng([latitude,longitude]);
  });
}
</script>
</body>
</html>
