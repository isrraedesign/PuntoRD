<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Mapa Puerto Plata</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css"/>
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css"/>

<style>
html, body, #map { height: 100%; margin:0; padding:0; }
body { font-family: Arial; background:#f3f9ff; }
#map { width:100%; height:100%; }
.panel { position:absolute; top:10px; left:10px; width:300px; max-height:90%; overflow:auto; background:white; padding:10px; border-radius:10px; box-shadow:0 4px 12px rgba(0,0,0,0.15); z-index:1000; }
.search { width:95%; padding:5px; margin-bottom:6px; border-radius:6px; border:1px solid #ccc; }
.place { padding:6px; border-bottom:1px solid #eee; }
button { padding:4px 8px; border-radius:6px; border:1px solid #ccc; cursor:pointer; margin-top:4px; }
button:hover { background:#f0f0f0; }
</style>
</head>
<body>
<div id="map"></div>
<div class="panel">
<h3>Puerto Plata</h3>
<input class="search" id="searchBox" placeholder="Buscar lugar...">
<div id="placesList"></div>
</div>

<script>
// Espera a que la página cargue
document.addEventListener('DOMContentLoaded', ()=>{
  const map = L.map('map').setView([19.7934, -70.6884], 13);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom:18, attribution:'© OpenStreetMap'}).addTo(map);

  const ICONS = { default:'#0ea5e9' };

  // Generar 150 marcadores de prueba
  const places = [];
  for(let i=1;i<=150;i++){
    const lat = 19.78 + (Math.random()-0.5)*0.08;
    const lon = -70.69 + (Math.random()-0.5)*0.08;
    places.push({name:'Lugar '+i,lat,lon});
  }

  const markers = L.markerClusterGroup();
  places.forEach(p=>{
    const marker = L.marker([p.lat,p.lon],{icon:L.divIcon({html:`<div style="width:16px;height:16px;background:${ICONS.default};border-radius:50%;border:2px solid white;"></div>`,className:'',iconSize:[16,16]})});
    marker.bindPopup(p.name);
    markers.addLayer(marker);
    p.marker = marker;
  });
  map.addLayer(markers);

  const list = document.getElementById('placesList');
  function renderList(){
    list.innerHTML='';
    const query = document.getElementById('searchBox').value.toLowerCase();
    places.filter(p=>p.name.toLowerCase().includes(query)).forEach(p=>{
      const div = document.createElement('div');
      div.className='place';
      div.innerHTML = `<b>${p.name}</b><br><button onclick="map.flyTo([${p.lat},${p.lon}],16)">Ver</button>`;
      list.appendChild(div);
    });
  }
  renderList();
  document.getElementById('searchBox').addEventListener('input',renderList);

  // GPS en tiempo real
  let userMarker=null;
  if(navigator.geolocation){
    navigator.geolocation.watchPosition(pos=>{
      const loc=[pos.coords.latitude,pos.coords.longitude];
      if(!userMarker){
        userMarker=L.marker(loc,{icon:L.divIcon({html:`<div style="width:12px;height:12px;background:green;border-radius:50%"></div>`})}).addTo(map);
        map.setView(loc,13);
      }else userMarker.setLatLng(loc);
    });
  }
});
</script>
</body>
</html>
