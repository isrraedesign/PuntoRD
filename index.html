<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>Mapa TurÃ­stico de Puerto Plata</title>

<!-- LibrerÃ­as Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
html,body,#map { height:100%; margin:0; padding:0; }
body { font-family: 'Segoe UI', Arial, sans-serif; background:#eef4fa; }
#map { width:100%; height:100%; }
.lang { position:absolute; top:10px; right:10px; z-index:1000; background:white; padding:8px; border-radius:10px; box-shadow:0 2px 10px rgba(0,0,0,0.2); }
.sidebar { position:absolute; top:10px; left:10px; z-index:1000; background:white; padding:10px; width:270px; max-height:90%; overflow-y:auto; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.2); }
button { background:#fff; border:1px solid #ccc; border-radius:6px; padding:5px 8px; cursor:pointer; }
button:hover { background:#f0f0f0; }
.place { padding:6px 0; border-bottom:1px solid #eee; }
</style>
</head>
<body>
<div id="map"></div>

<!-- Selector de idioma -->
<div class="lang">
  <button onclick="setLang('es')">ðŸ‡ªðŸ‡¸</button>
  <button onclick="setLang('en')">ðŸ‡¬ðŸ‡§</button>
  <button onclick="setLang('fr')">ðŸ‡«ðŸ‡·</button>
</div>

<!-- Lista lateral -->
<div class="sidebar">
  <h3>Puerto Plata</h3>
  <div id="placesList"></div>
</div>

<script>
let LANG = 'es';
const map = L.map('map').setView([19.79, -70.69], 12);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  maxZoom: 18,
  attribution: 'Â© OpenStreetMap'
}).addTo(map);

// FunciÃ³n para cambiar idioma
function setLang(l){ LANG = l; renderList(); }

// Lista de lugares (simplificada)
const places = [
  {name:'TelefÃ©rico Isabel de Torres',lat:19.7829,lon:-70.7038,desc:{es:'Vista panorÃ¡mica',en:'Panoramic view',fr:'Vue panoramique'}},
  {name:'Playa Dorada',lat:19.7753,lon:-70.6424,desc:{es:'Playa de arena dorada',en:'Golden sand beach',fr:'Plage de sable dorÃ©'}},
  {name:'Fortaleza San Felipe',lat:19.8013,lon:-70.6909,desc:{es:'Fortaleza colonial',en:'Colonial fortress',fr:'Forteresse coloniale'}}
];

const catColor = {default:'#0ea5e9'};
function makeIcon(color){
  return L.divIcon({
    html:`<div style="width:26px;height:26px;background:${color};border-radius:50%;border:2px solid white;"></div>`,
    className:'', iconSize:[26,26]
  });
}

let markers = [];
places.forEach(p=>{
  const marker = L.marker([p.lat, p.lon],{icon:makeIcon(catColor.default)}).addTo(map);
  marker.bindPopup(`<b>${p.name}</b><br>${p.desc[LANG]}`);
  markers.push(marker);
});

// Lista lateral
function renderList(){
  const list = document.getElementById('placesList');
  list.innerHTML='';
  places.forEach(p=>{
    const div = document.createElement('div');
    div.className='place';
    div.innerHTML = `<b>${p.name}</b><br>${p.desc[LANG]}<br>
      <button onclick="flyTo(${p.lat},${p.lon})">${LANG==='es'?'Ver':'en'===LANG?'View':'Voir'}</button>
      <button onclick="routeTo(${p.lat},${p.lon})">${LANG==='es'?'CÃ³mo llegar':LANG==='en'?'Route':'ItinÃ©raire'}</button>`;
    list.appendChild(div);
  });
}
renderList();

// Centrar vista
function flyTo(lat,lon){ map.flyTo([lat,lon],15); }

// Marcador de usuario
let userMarker=null, routeLine=null;
if(navigator.geolocation){
  navigator.geolocation.watchPosition(pos=>{
    const {latitude,longitude}=pos.coords;
    if(!userMarker){
      userMarker=L.marker([latitude,longitude],{icon:makeIcon('green')}).addTo(map);
    } else {
      userMarker.setLatLng([latitude,longitude]);
    }
  });
}

// FunciÃ³n de ruta (OSRM)
async function routeTo(lat,lon){
  if(!userMarker){ alert('UbicaciÃ³n no detectada'); return; }
  const u=userMarker.getLatLng();
  const url=`https://router.project-osrm.org/route/v1/driving/${u.lng},${u.lat};${lon},${lat}?overview=full&geometries=geojson`;
  const res=await fetch(url); const data=await res.json();
  const coords=data.routes[0].geometry.coordinates.map(c=>[c[1],c[0]]);
  const dist=(data.routes[0].distance/1000).toFixed(1);
  const time=(data.routes[0].duration/60).toFixed(0);
  if(routeLine){ map.removeLayer(routeLine); }
  routeLine=L.polyline(coords,{color:'#2563eb',weight:5}).addTo(map);
  map.fitBounds(routeLine.getBounds());
  alert(`${LANG==='es'?'Distancia':'en'===LANG?'Distance':'Distance'}: ${dist} km | ${LANG==='es'?'Tiempo estimado':'en'===LANG?'Estimated time':'Temps estimÃ©'}: ${time} min`);
}
</script>
</body>
</html>
