<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>Mapa Tur√≠stico de Puerto Plata</title>

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>

<style>
html,body,#map{height:100%;margin:0;}
body{font-family:Inter,Segoe UI,Arial;background:#f8fafc;color:#334155;}
#map{z-index:1;}
.lang{position:absolute;top:10px;right:10px;background:white;padding:8px;border-radius:10px;box-shadow:0 2px 10px rgba(0,0,0,0.1);z-index:1000;}
button{cursor:pointer;margin:2px;padding:4px 8px;border-radius:8px;border:1px solid #ccc;background:white;}
.sidebar{position:absolute;top:10px;left:10px;width:260px;max-height:90%;overflow:auto;background:white;border-radius:14px;padding:10px;box-shadow:0 10px 20px rgba(0,0,0,0.1);z-index:1000;}
.place{padding:4px 0;border-bottom:1px solid #e2e8f0;}
</style>
</head>

<body>
<div id="map"></div>

<!-- Selector de idioma -->
<div class="lang">
  <button onclick="setLang('es')">üá™üá∏</button>
  <button onclick="setLang('en')">üá¨üáß</button>
  <button onclick="setLang('fr')">üá´üá∑</button>
</div>

<!-- Lista lateral -->
<div class="sidebar" id="sidebar">
  <h3>Puerto Plata</h3>
  <div id="placesList"></div>
</div>

<script>
// Idioma actual
let LANG='es';

// Crear mapa centrado en Puerto Plata
const map=L.map('map').setView([19.79,-70.69],12);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
  {maxZoom:19,attribution:'¬© OpenStreetMap'}).addTo(map);

// Cambiar idioma
function setLang(l){LANG=l;renderList();}

// ======= Lista de lugares =======
const places=[
  {id:'1',name:'Telef√©rico Isabel de Torres',lat:19.7829,lon:-70.7038,cat:'attraction',desc:{es:'Vista panor√°mica',en:'Panoramic view',fr:'Vue panoramique'}},
  {id:'2',name:'Playa Dorada',lat:19.7753,lon:-70.6424,cat:'beach',desc:{es:'Famosa playa de arena dorada',en:'Famous golden beach',fr:'Plage dor√©e c√©l√®bre'}},
  {id:'3',name:'Fortaleza San Felipe',lat:19.801283,lon:-70.690886,cat:'historic',desc:{es:'Fortaleza colonial',en:'Colonial fortress',fr:'Forteresse coloniale'}},
  {id:'4',name:'Museo del √Åmbar',lat:19.7964,lon:-70.6922,cat:'museum',desc:{es:'Museo dedicado al √°mbar dominicano',en:'Amber museum',fr:'Mus√©e de l\'ambre'}},
  {id:'5',name:'Parque Central',lat:19.795,-70.6939,cat:'park',desc:{es:'Centro de la ciudad',en:'City center',fr:'Centre-ville'}},
  {id:'6',name:'Zona de Precauci√≥n: Callej√≥n La Loma',lat:19.792,-70.700,cat:'danger',desc:{es:'Zona con alto riesgo de robos nocturnos',en:'Area with higher night risk',fr:'Zone √† risque la nuit'}}
];

// Crear lugares aleatorios (simulados hasta tener 300)
for(let i=7;i<=300;i++){
  let lat=19.79+(Math.random()-0.5)*0.1;
  let lon=-70.69+(Math.random()-0.5)*0.1;
  places.push({
    id:String(i),
    name:'Lugar '+i,
    lat,lon,
    cat:['hotel','restaurant','shop','beach','park'][i%5],
    desc:{es:'Lugar tur√≠stico',en:'Touristic place',fr:'Lieu touristique'}
  });
}

// Colores por categor√≠a
function makeIcon(color){
  return L.divIcon({
    html:`<div style="width:28px;height:28px;background:${color};
           border-radius:50%;border:2px solid white;"></div>`,
    iconSize:[28,28],className:''
  });
}
const catColor={
  beach:'#0284c7', hotel:'#06b6d4', restaurant:'#ef4444', museum:'#7c3aed',
  park:'#10b981', historic:'#f97316', danger:'#f43f5e', shop:'#f59e0b', attraction:'#fbbf24'
};

// Marcadores
const markers=L.markerClusterGroup();
places.forEach(p=>{
  const icon=makeIcon(catColor[p.cat]||'#64748b');
  const m=L.marker([p.lat,p.lon],{icon});
  m.bindPopup(`<b>${p.name}</b><br>${p.desc[LANG]||''}<br><small>${p.cat}</small>`);
  markers.addLayer(m);
});
map.addLayer(markers);

// Lista lateral
function renderList(){
  const list=document.getElementById('placesList');
  list.innerHTML='';
  places.forEach(p=>{
    const div=document.createElement('div');
    div.className='place';
    div.innerHTML=`<b>${p.name}</b><br>${p.desc[LANG]||''}<br>
      <button onclick="flyTo(${p.lat},${p.lon})">
        ${LANG==='es'?'Ver':LANG==='en'?'View':'Voir'}
      </button>
      <button onclick="routeTo(${p.lat},${p.lon})">
        ${LANG==='es'?'Ruta':LANG==='en'?'Route':'Itin√©raire'}
      </button>`;
    list.appendChild(div);
  });
}
renderList();

// Funci√≥n para centrar mapa
function flyTo(lat,lon){map.flyTo([lat,lon],15);}

// Posici√≥n del usuario
let userMarker=null,routeLine=null;
if(navigator.geolocation){
  navigator.geolocation.watchPosition(pos=>{
    const {latitude,longitude}=pos.coords;
    if(!userMarker){
      userMarker=L.marker([latitude,longitude],{icon:makeIcon('#0ea5e9')}).addTo(map);
    } else {
      userMarker.setLatLng([latitude,longitude]);
    }
  },()=>{}, {enableHighAccuracy:true});
}

// Ruta en tiempo real
function routeTo(lat,lon){
  if(!userMarker){alert('Ubicaci√≥n no detectada');return;}
  const u=userMarker.getLatLng();
  fetch(`https://router.project-osrm.org/route/v1/driving/${u.lng},${u.lat};${lon},${lat}?overview=full&geometries=geojson`)
  .then(r=>r.json())
  .then(j=>{
    const coords=j.routes[0].geometry.coordinates.map(c=>[c[1],c[0]]);
    if(routeLine){map.removeLayer(routeLine);}
    routeLine=L.polyline(coords,{color:'#0ea5e9',weight:5}).addTo(map);
    map.fitBounds(routeLine.getBounds());
  });
}
</script>
</body>
</html>
