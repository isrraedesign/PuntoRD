<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Mapa Tur√≠stico Puerto Plata</title>

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />

<style>
html, body, #map { height:100%; margin:0; padding:0; }
body { font-family: 'Segoe UI', Arial; background:#f3f9ff; }
#map { width:100%; height:100%; }

.panel{position:absolute; top:10px; left:10px; width:320px; max-height:90%; overflow:auto; background:white; padding:10px; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.15); z-index:1000;}
.langbox{position:absolute; top:10px; right:10px; background:white; padding:8px; border-radius:10px; box-shadow:0 2px 10px rgba(0,0,0,0.2); z-index:1000;}
.place{padding:6px; border-bottom:1px solid #eee;}
button{padding:5px 8px; border-radius:6px; border:1px solid #ccc; cursor:pointer; margin-top:4px;}
button:hover{background:#f0f0f0;}
.search{width:95%; padding:5px; margin-bottom:6px; border-radius:6px; border:1px solid #ccc;}
</style>
</head>
<body>
<div id="map"></div>

<div class="panel">
<h3>Puerto Plata</h3>
<input class="search" id="searchBox" placeholder="Buscar lugar...">
<div id="filters">
<button class="filter" data-cat="all">Todos</button>
<button class="filter" data-cat="beach">Playas</button>
<button class="filter" data-cat="hotel">Hoteles</button>
<button class="filter" data-cat="restaurant">Restaurantes</button>
<button class="filter" data-cat="museum">Museos</button>
<button class="filter" data-cat="park">Parques</button>
<button class="filter" data-cat="attraction">Atracciones</button>
<button class="filter" data-cat="danger">Precauci√≥n</button>
</div>
<div id="placesList"></div>
</div>

<div class="langbox">
<button onclick="setLang('es')">üá™üá∏</button>
<button onclick="setLang('en')">üá¨üáß</button>
<button onclick="setLang('fr')">üá´üá∑</button>
</div>

<script>
// --- Configuraci√≥n ---
let LANG='es';
const map = L.map('map').setView([19.7934,-70.6884],13);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:18,attribution:'¬© OpenStreetMap'}).addTo(map);

const ICONS = {beach:'#0284c7', hotel:'#06b6d4', restaurant:'#ef4444', museum:'#7c3aed', park:'#10b981', attraction:'#f97316', danger:'#ef4444', default:'#64748b'};

// --- Lugares (verificados + generados hasta 150+) ---
const places = [
  {name:'Telef√©rico Isabel de Torres',lat:19.7829,lon:-70.7038,category:'attraction',desc:{es:'Telef√©rico al monte Isabel de Torres',en:'Cable car to Mount Isabel de Torres',fr:'T√©l√©ph√©rique vers le mont Isabel de Torres'}},
  {name:'Fortaleza San Felipe',lat:19.8013,lon:-70.6909,category:'museum',desc:{es:'Fuerte hist√≥rico',en:'Historic fortress',fr:'Forteresse historique'}},
  {name:'Playa Dorada',lat:19.7740,lon:-70.6421,category:'beach',desc:{es:'Resort / playa',en:'Resort beach',fr:'Plage resort'}},
  {name:'Ocean World',lat:19.8262,lon:-70.7303,category:'attraction',desc:{es:'Parque acu√°tico',en:'Water park',fr:'Parc aquatique'}},
  {name:'Museo del √Åmbar',lat:19.7964,lon:-70.6922,category:'museum',desc:{es:'Museo del √°mbar',en:'Amber museum',fr:'Mus√©e de l\'ambre'}},
  {name:'Malec√≥n de Puerto Plata',lat:19.8019,lon:-70.6880,category:'attraction',desc:{es:'Paseo mar√≠timo',en:'Seafront promenade',fr:'Promenade en bord de mer'}}
];

// --- Generar lugares de prueba hasta 150 ---
for(let i=7;i<=150;i++){
  let lat = 19.78 + (Math.random()-0.5)*0.08;
  let lon = -70.69 + (Math.random()-0.5)*0.08;
  let cat=['hotel','restaurant','beach','museum','park','attraction','danger'][i%7];
  places.push({name:`Lugar ${i}`,lat:parseFloat(lat.toFixed(6)),lon:parseFloat(lon.toFixed(6)),category:cat,desc:{es:`Descripci√≥n ${i}`,en:`Description ${i}`,fr:`Description ${i}`}});
}

// --- Cl√∫ster de marcadores ---
const markers = L.markerClusterGroup();
places.forEach(p=>{
  const color = ICONS[p.category]||ICONS.default;
  const marker = L.marker([p.lat,p.lon],{icon:L.divIcon({html:`<div style="width:20px;height:20px;background:${color};border-radius:50%;border:2px solid white;"></div>`,className:'',iconSize:[20,20]})});
  marker.bindPopup(`<b>${p.name}</b><br>${p.desc[LANG]}`);
  markers.addLayer(marker);
  p.marker = marker;
});
map.addLayer(markers);

// --- Lista lateral ---
function renderList(){
  const list = document.getElementById('placesList');
  list.innerHTML='';
  const query = document.getElementById('searchBox').value.toLowerCase();
  let filter = document.querySelector('#filters .active')?.dataset.cat||'all';
  places.filter(p=>{
    if(filter!=='all' && p.category!==filter) return false;
    if(query && !p.name.toLowerCase().includes(query) && !p.desc[LANG].toLowerCase().includes(query)) return false;
    return true;
  }).forEach(p=>{
    const div = document.createElement('div');
    div.className='place';
    div.innerHTML = `<b>${p.name}</b><br>${p.desc[LANG]}<br>
    <button onclick="map.flyTo([${p.lat},${p.lon}],16)">${LANG==='es'?'Ver':LANG==='en'?'View':'Voir'}</button>
    <button onclick="routeTo(${p.lat},${p.lon})">${LANG==='es'?'C√≥mo llegar':LANG==='en'?'Directions':'Itin√©raire'}</button>`;
    list.appendChild(div);
  });
}
renderList();
document.getElementById('searchBox').addEventListener('input',renderList);

// --- Filtros ---
document.querySelectorAll('#filters .filter').forEach(b=>b.addEventListener('click',()=>{
  document.querySelectorAll('#filters .filter').forEach(x=>x.classList.remove('active'));
  b.classList.add('active');
  renderList();
}));

// --- Cambiar idioma ---
function setLang(l){
  LANG=l;
  markers.eachLayer(m=>{
    const p = places.find(x=>x.marker===m);
    if(p) m.bindPopup(`<b>${p.name}</b><br>${p.desc[LANG]}`);
  });
  renderList();
}

// --- GPS y rutas ---
let userMarker=null, userLoc=null;
if(navigator.geolocation){
  navigator.geolocation.watchPosition(pos=>{
    userLoc=[pos.coords.latitude,pos.coords.longitude];
    if(!userMarker) userMarker=L.marker(userLoc,{icon:L.divIcon({html:`<div style="width:14px;height:14px;background:green;border-radius:50%"></div>`})}).addTo(map);
    else userMarker.setLatLng(userLoc);
  });
}
let routeLine=null;
async function routeTo(lat,lon){
  if(!userLoc){ alert('No se detecta ubicaci√≥n'); return; }
  const mode = prompt('Modo: driving, walking, cycling','driving')||'driving';
  const url = `https://router.project-osrm.org/route/v1/${mode}/${userLoc[1]},${userLoc[0]};${lon},${lat}?overview=full&geometries=geojson`;
  const res = await fetch(url); const data = await res.json();
  if(routeLine) map.removeLayer(routeLine);
  const coords = data.routes[0].geometry.coordinates.map(c=>[c[1],c[0]]);
  routeLine = L.polyline(coords,{color:'#2563eb',weight:5}).addTo(map);
  map.fitBounds(routeLine.getBounds());
  const mins = Math.round(data.routes[0].duration/60);
  const km = (data.routes[0].distance/1000).toFixed(1);
  alert(`Distancia: ${km} km\nTiempo estimado: ${mins} min`);
}
</script>
</body>
</html>
