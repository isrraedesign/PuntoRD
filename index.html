<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mapa Tur√≠stico de Puerto Plata</title>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.Default.css" />

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    #map { height: 100vh; }
    .leaflet-popup-content { font-size: 0.9rem; }
    .category-badge {
      display: inline-block;
      padding: 2px 6px;
      border-radius: 6px;
      font-size: 0.7rem;
      color: white;
    }
    .cat-playa { background-color: #1E90FF; }
    .cat-hotel { background-color: #00B894; }
    .cat-restaurante { background-color: #FF7675; }
    .cat-historico { background-color: #6C5CE7; }
    .cat-atraccion { background-color: #FDCB6E; }
    .cat-zona-riesgo { background-color: #E74C3C; } /* para zonas de precauci√≥n */
  </style>
</head>

<body class="bg-gray-100">
  <div class="flex flex-col md:flex-row h-screen">
    <!-- Sidebar -->
    <div class="w-full md:w-1/4 bg-white p-4 overflow-y-auto shadow-lg z-10">
      <h1 class="text-2xl font-bold mb-2 text-blue-600">Puerto Plata / Tourist Map / Carte Touristique</h1>
      <p class="text-sm text-gray-600 mb-4">
        ES: Lugares tur√≠sticos ‚Ä¢ rutas ‚Ä¢ simulaci√≥n ‚Ä¢ zonas de precauci√≥n<br>
        EN: Tourist spots ‚Ä¢ routes ‚Ä¢ simulation ‚Ä¢ caution areas<br>
        FR: Lieux touristiques ‚Ä¢ itin√©raires ‚Ä¢ simulation ‚Ä¢ zones √† risque
      </p>

      <input id="search" type="text" placeholder="Buscar lugar / Search place / Rechercher lieu..." class="w-full border rounded-lg p-2 mb-4" />

      <div id="placesList" class="space-y-2"></div>

      <div class="mt-4 text-xs text-gray-500">
        ES: Las zonas marcadas como ‚Äúprecauci√≥n‚Äù indican √°reas donde se recomienda tomar taxi y evitar caminar solo.<br>
        EN: Areas marked as ‚Äúcaution‚Äù indicate zones where it‚Äôs recommended to take a taxi and avoid walking alone.<br>
        FR: Les zones marqu√©es ¬´ pr√©caution ¬ª indiquent des zones o√π il est recommand√© de prendre un taxi et d‚Äô√©viter de marcher seul.
      </div>
    </div>

    <!-- Map -->
    <div id="map" class="flex-1"></div>
  </div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet.markercluster/dist/leaflet.markercluster.js"></script>

  <script>
    // Inicializar mapa
    const map = L.map('map').setView([19.7934, -70.6884], 13);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 18,
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // M√°s lugares reales + zonas de precauci√≥n
    const places = [
      { name: "Playa Dorada", coords: [19.7753, -70.6424], category: "playa", desc:"ES: Playa popular. / EN: Popular beach. / FR: Plage populaire." },
      { name: "Malec√≥n de Puerto Plata", coords: [19.8019, -70.6880], category: "atraccion", desc:"ES: Paseo mar√≠timo. / EN: Seafront promenade. / FR: Promenade en bord de mer." },
      { name: "Fortaleza San Felipe", coords: [19.801283, -70.690886], category: "historico", desc:"ES: Fuerte del siglo XVI. / EN: 16th c. fortress. / FR: Forteresse du XVIe s." },
      { name: "Telef√©rico ‚Äì Isabel de Torres", coords: [19.7829, -70.7038], category: "atraccion", desc:"ES: Telef√©rico al monte. / EN: Cable-car to mountain. / FR: T√©l√©ph√©rique vers la montagne." },
      { name: "Museo del √Åmbar", coords: [19.7964, -70.6922], category: "atraccion", desc:"ES: Museo de √°mbar. / EN: Amber museum. / FR: Mus√©e de l'ambre." },
      { name: "Amber Cove", coords: [19.8344, -70.7755], category: "atraccion", desc:"ES: Terminal de cruceros. / EN: Cruise ship terminal. / FR: Terminal de croisi√®res." },
      { name: "Playa Cofres√≠", coords: [19.8218, -70.6647], category: "playa", desc:"ES: Playa p√∫blica acu√°tica. / EN: Public water-beach. / FR: Plage publique." },
      { name: "Casa Colonial Beach & Spa", coords: [19.7975, -70.6886], category: "hotel", desc:"ES: Hotel boutique. / EN: Boutique hotel. / FR: H√¥tel boutique." },
      { name: "Senator Puerto Plata Resort", coords: [19.8220, -70.7310], category: "hotel", desc:"ES: Resort todo incluido. / EN: All-inclusive resort. / FR: Resort tout compris." },
      { name: "Restaurante Costa Azul", coords: [19.7992, -70.6890], category: "restaurante", desc:"ES: Marisquer√≠a popular. / EN: Popular seafood restaurant. / FR: Restaurant de fruits de mer populaire." },
      // Zonas de precauci√≥n / riesgo
      { name: "Zona que requiere precauci√≥n ‚Äì Parte baja ciudad", coords: [19.7950, -70.6990], category: "zona-riesgo", desc:"ES: Evitar caminar solo en horas tarde. / EN: Avoid walking alone late hours. / FR: √âviter de marcher seul tard le soir." },
      { name: "√Årea de taxi recomendado ‚Äì Barrio oscuro", coords: [19.7890, -70.7030], category: "zona-riesgo", desc:"ES: Se recomienda tomar taxi. / EN: Taxi recommended. / FR: Taxi recommand√©." }
    ];

    const icons = {
      playa: "üèñÔ∏è", hotel: "üè®", restaurante: "üçΩÔ∏è", historico: "üèõÔ∏è", atraccion: "üé°", "zona-riesgo": "‚ö†Ô∏è"
    };

    const markers = L.markerClusterGroup();

    places.forEach((p) => {
      const marker = L.marker(p.coords).bindPopup(`
        <b>${p.name}</b><br>
        <span class="category-badge cat-${p.category}">${p.category}</span><br><br>
        ${p.desc}
      `);
      markers.addLayer(marker);
    });

    map.addLayer(markers);

    // Lista lateral y b√∫squeda
    const list = document.getElementById('placesList');
    function renderList(filter = "") {
      list.innerHTML = "";
      places.filter(p => p.name.toLowerCase().includes(filter.toLowerCase()) || p.desc.toLowerCase().includes(filter.toLowerCase())).forEach((p) => {
        const div = document.createElement("div");
        div.className = "p-2 border rounded hover:bg-blue-50 cursor-pointer flex justify-between";
        div.innerHTML = `${icons[p.category]} <span><strong>${p.name}</strong><br><small>${p.desc}</small></span>`;
        div.onclick = () => {
          map.setView(p.coords, 15);
          // abrir popup
          const m = markers.getLayers().find(mk => mk.getLatLng().lat === p.coords[0] && mk.getLatLng().lng === p.coords[1]);
          if(m) m.openPopup();
        };
        list.appendChild(div);
      });
    }
    renderList();

    document.getElementById('search').addEventListener('input', (e) => renderList(e.target.value));

    // rutas (igual que antes)
    let routeLayer;
    function routeTo(lat, lon) {
      if (routeLayer) map.removeLayer(routeLayer);
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(pos => {
          const { latitude, longitude } = pos.coords;
          fetch(`https://router.project-osrm.org/route/v1/driving/${longitude},${latitude};${lon},${lat}?overview=full&geometries=geojson`)
            .then(res => res.json())
            .then(data => {
              const coords = data.routes[0].geometry.coordinates.map(c => [c[1], c[0]]);
              routeLayer = L.polyline(coords, { color: 'blue' }).addTo(map);
              map.fitBounds(routeLayer.getBounds());
              alert(`Duraci√≥n estimada: ${(data.routes[0].duration / 60).toFixed(1)} minutos`);
            });
        });
      } else {
        alert("No se pudo obtener la ubicaci√≥n actual.");
      }
    }

    // Simulaci√≥n simple (puedes mantener o quitar)
    for (let i = 0; i < 5; i++) {
      const t = L.circleMarker([19.7934 + Math.random()*0.02 - 0.01, -70.6884 + Math.random()*0.02 - 0.01], {
        radius: 6, color: 'red'
      }).addTo(map);
      setInterval(() => {
        const latlng = t.getLatLng();
        const newLat = latlng.lat + (Math.random() - 0.5) * 0.0005;
        const newLng = latlng.lng + (Math.random() - 0.5) * 0.0005;
        t.setLatLng([newLat, newLng]);
      }, 3000);
    }
  </script>
</body>
</html>
